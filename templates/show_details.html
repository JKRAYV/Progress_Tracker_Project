<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <title>Show Details</title>
</head>
<body>
    <div class="header">
        <h1><a href="{{ url_for('dashboard') }}">Progress Tracker Dashboard</a></h1>
    </div>
    <div class="container">
        <h1>{{ show.Title }}</h1>
        
        <!-- Linear progress bar -->
        <div class="linear-progress-container">
            <div class="linear-progress-bar" id="linear-progress-bar"></div>
        </div>

        <p>Status: {{ user_show.Status }}</p>
        <p>Current Episode: {{ user_show.Episodes }}</p>

        {% if user_show.Status == "watching" %}
            <form action="{{ url_for('advance_episode', show_title=show.Title) }}" method="POST">
                <button type="submit" id="next-episode-button">NEXT EPISODE</button>
            </form>
        {% elif user_show.Status == "plan to watch" %}
            <form action="{{ url_for('advance_episode', show_title=show.Title) }}" method="POST">
                <button type="submit">START WATCHING</button>
            </form>
        {% elif user_show.Status == "completed" %}
            <form action="{{ url_for('restart_show', show_title=show.Title) }}" method="POST">
                <button type="submit" id="restart-button" style="display: none;">RESTART</button>
            </form>
            <form action="{{ url_for('remove_show', show_title=show.Title) }}" method="POST">
                <button type="submit" id="remove-button" style="display: none;">REMOVE</button>
            </form>
        {% endif %}
    </div>

    <script>
       document.getElementById('next-episode-button').addEventListener('click', function(e) {
    e.preventDefault();

    fetch(`{{ url_for('advance_episode', show_title=show.Title) }}`, { method: 'POST' })
    .then(response => response.json())
    .then(data => {
        const progressBar = document.getElementById('linear-progress-bar');
        const currentEpisodeElement = document.querySelector(".container p:nth-child(4)");
        const statusElement = document.querySelector(".container p:nth-child(3)");
        const restartButton = document.getElementById('restart-button');
        const removeButton = document.getElementById('remove-button');

        if (data.completion_percentage) {
            progressBar.style.width = data.completion_percentage + "%";
            progressBar.textContent = data.completion_percentage.toFixed(2) + "%";
        }

        if (data.current_episode) {
            currentEpisodeElement.textContent = "Current Episode: " + data.current_episode;
        }

        if (data.status) {
            statusElement.textContent = "Status: " + data.status;

            if (data.status === "completed") {
                document.getElementById('next-episode-button').style.display = 'none';
                restartButton.style.display = 'inline-block';
                removeButton.style.display = 'inline-block';
            }
        }
    })
    .catch(error => {
        console.error('Error updating progress:', error);
    });
});

    </script>
</body>
</html>
